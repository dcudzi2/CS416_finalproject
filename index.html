<html>
<script src="https://d3js.org/d3.v4.js"></script>

<style>
    .center {
        margin: auto;
        width: 80%;
        border: 3px solid #73AD21;
        padding: 30px;
    }
</style>

<h1 style="font-family: Helvetica; text-align:center; font-size: 30px">
    CS416: Air Quality 2020 (EPA)
</h1>
<h2 style="font-family: Helvetica; text-align:center; font-size: 15px">
    <em>By Daniel Cudzich as part of Summer 2023</em>
</h2>
    
<div style="text-align:center;">
    <p class="center" style="font-family: Helvetica; font-size: 12px">
        The Environmental Protection Agency (EPA) tracks air quality data across the United States, with meteorological stations running to collect data on a daily basis, sometimes even hourly. This allows for extensive tracking over time as well as comparisons between geographic regions, although major gaps do exist within and between states, with some states missing data for certain pollutants entirely. This data visualization illustrates air quality across the U.S., with notable trends, caveats, and additional details provided where relevant.
    </p>
        
    <svg id="mainmap" width="750" height="500" style="border:1px solid black"></svg>
    
    <script>

    //data_O3 = await d3.csv("https://dcudzi2.github.io/CS416_finalproject/daily_44201_2020_OZONE_ABRIDGED.csv");
    //data_NO2 = await d3.csv("https://dcudzi2.github.io/CS416_finalproject/daily_42602_2020_NO2_ABRIDGED.csv");

    //LET FUNCTIONS FOR EVENTS
    let mouseOver = function(d) {
        d3.selectAll(".State")
            .transition()
            .duration(100)
            .style("opacity", .5)
        d3.select(this)
            .transition()
            .duration(100)
            .style("opacity", 1)
        //tooltip.text(d);
        return tooltip.style("visibility", "visible");
    }
      
    let mouseLeave = function(d) {
        d3.selectAll(".State")
            .transition()
            .duration(100)
            .style("opacity", .8)
        d3.select(this)
            .transition()
            .duration(100)
        return tooltip.style("visibility", "hidden");
    }

    let mouseMove = function(d) {
        return tooltip
        	.style("top", (d3.event.pageY-40)+"px")
            .style("left",(d3.event.pageX-40)+"px")
            .html("Meme " + d.id)
    }

    //Toooltip setup
    var tooltip = d3.select("body")
        .append("div")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("background-color", "white")
        .html("<p font-family: Helvetica; font-size: 10px>You should not be seeing this.</p>");
        
    var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");
    
    //Get the map created and centered
    var path = d3.geoPath();
    var projection = d3.geoMercator()
      .scale(325)
      .center([-125,52])
      .translate([width / 2, height / 2]);
    
    //Create the color scale
    var data = d3.map();
    var colorScale = d3.scaleLinear()
      .domain([0,12.5,25])
      .range(['green','yellow','red']);
    
    // Load external data and boot
    d3.queue()
      .defer(d3.json, "https://dcudzi2.github.io/CS416_finalproject/us-states1.json")
      .defer(d3.csv, "https://dcudzi2.github.io/CS416_finalproject/statesdata1.csv", function(d) { data.set(d.id, d.value); })
      .await(ready);
    
    function ready(error, topo) {
    
      // Draw the map
      svg.append("g")
        .selectAll("path")
        .data(topo.features)
        .enter()
        .append("path")
          // draw each State
          .attr("d", d3.geoPath()
            .projection(projection)
          )
          // set the color of each State
          .attr("fill", function (d) {
            d.total = data.get(d.id) || 0;
            return colorScale(d.total);
          })
        .style("stroke", "transparent")
      	.attr("class", function(d){ return "State" })
        .attr("AQI", function(d) {return d.value})
      	.style("opacity", .8)
      	.on("mouseover", mouseOver)
      	.on("mouseleave", mouseLeave)
        .on("mousemove", mouseMove)
    }
    
    </script>
    
</div>

<p style="font-family: Helvetica; font-size: 10px">
    <em>EPA data obtained from <a href="https://aqs.epa.gov/aqsweb/airdata/download_files.html#Meta">this EPA website allowing for downloads of prepared summary data.</a> Look for the "Daily Summary Data" table, year 2020.</em>
</p>
<p style="font-family: Helvetica; font-size: 10px">
    <em>Many thanks to <a href="https://d3-graph-gallery.com/graph/choropleth_hover_effect.html">Yan Holtz</a> for this resource in creating choropleths with D3.</em>
</p>
    
</html>
